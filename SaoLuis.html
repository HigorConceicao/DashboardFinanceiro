<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Financeiro</title>
  <link rel="stylesheet" href="SaoLuis.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <script>
    // checar login cedo (redireciona se não logado)
    if (!localStorage.getItem("loggedUser")) {
      window.location.href = "login.html";
    }
  </script>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <img class="logo" src="Financas.jpeg" alt="logo" />
      <h1>MoneyMate</h1>

      <div class="toolbar-buttons" style="margin-left:auto; display:flex; gap:8px; align-items:center;">
        <button onclick="window.location.href='relatorio.html'" class="btn-top">Relatório</button>
        <button id="logoutBtn" class="btn logout-btn" style="width:auto; padding:6px 12px;">Logout</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- KPIs -->
    <section class="kpis">
      <div class="kpi-card">
        <div class="kpi-title">Receitas</div>
        <div class="kpi-value" id="kpi-receitas">€500,00</div>
        <div class="kpi-sub">Valor do mês</div>
      </div>

      <div class="kpi-card" id="card-despesas">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div class="kpi-title">Despesas totais do mês</div>
            <div class="kpi-sub"></div>
          </div>
          <div style="font-size:12px;color:var(--muted)"></div>
        </div>
        <div style="margin-top:8px;">
          <div class="kpi-value danger" id="kpi-despesas">€200,00</div>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-title">Lucro</div>
        <div class="kpi-value1" id="kpi-lucro">€300,00</div>
        <div class="kpi-sub">Receitas - Despesas</div>
      </div>
    </section>

    <!-- Quick buttons -->
    <section class="quick-buttons">
      <h3 style="margin:0 0 8px 0"></h3>
      <div id="monthButtons" class="month-buttons-container"></div>
    </section>

    <!-- Controls / Selected month title -->
    <div class="toolbar">
      <div id="selected-month-title" aria-live="polite">Selecionar um mês</div>
      <input type="month" id="monthFilter" aria-label="Filtrar por mês" />
    </div>

    <!-- Charts -->
    <section class="charts-grid">
      <div class="card chart-large">
        <h3 class="sr-only"></h3>
        <canvas id="mainChart"></canvas>
      </div>

      <div class="card chart-medium">
        <h3>Receitas</h3>
        <canvas id="donutReceita"></canvas>
      </div>

      <div class="card chart-medium" id="despesa-card">
        <h3>Despesas</h3>
        <canvas id="donutDespesa"></canvas>
        <div id="despesasList" class="despesas-list"></div>

        <div class="embedded-expense-form" id="embeddedExpenseForm" aria-hidden="true">
          <div class="form-inner">
            <h4>Nova Despesa</h4>
            <label>Nome</label>
            <input id="embedDespesaNome" type="text" placeholder="Ex: Estacionamento" />
            <label>Valor (€)</label>
            <input id="embedDespesaValor" type="number" min="0" step="0.01" />
            <label>Cor</label>
            <input id="embedDespesaCor" type="color" value="#ff6b6b" />
            <div class="form-actions">
              <button id="embedSalvarDespesa" class="btn">Salvar</button>
              <button id="embedCancelarDespesa" class="btn alt">Cancelar</button>
            </div>
            <div class="hint">Dica: clique fora do painel ou em Cancelar para fechar</div>
          </div>
        </div>

      </div>
    </section>

    <section class="months-cards" id="monthsCards" aria-label="Meses"></section>

    <div id="editModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <span id="closeModal" class="close" title="Fechar">&times;</span>
        <h3>Editar Mês</h3>

        <label for="editMonth">Mês:</label>
        <select id="editMonth">
          <option value="0">Janeiro</option>
          <option value="1">Fevereiro</option>
          <option value="2">Março</option>
          <option value="3">Abril</option>
          <option value="4">Maio</option>
          <option value="5">Junho</option>
          <option value="6">Julho</option>
          <option value="7">Agosto</option>
          <option value="8">Setembro</option>
          <option value="9">Outubro</option>
          <option value="10">Novembro</option>
          <option value="11">Dezembro</option>
        </select>

        <label for="editReceita">Receita (€):</label>
        <input type="number" id="editReceita" min="0" step="0.01" />

        <label for="editDespesa">Despesa (€):</label>
        <input type="number" id="editDespesa" min="0" step="0.01" />

        <button id="saveEdit" class="btn">Salvar</button>
      </div>
    </div>

    <div id="editExpenseModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <h3>Editar Despesa</h3>
        <label>Nome</label>
        <input id="editExpenseName" type="text" />
        <label>Valor</label>
        <input id="editExpenseValue" type="number" min="0" step="0.01" />
        <label>Cor</label>
        <input id="editExpenseColor" type="color" />
        <div style="display:flex; gap:8px;">
          <button id="saveEditedExpense" class="btn">Salvar Alteração</button>
          <button id="deleteExpense" class="btn alt">Excluir</button>
        </div>
      </div>
    </div>

  </main>

  <script>
    // logout simples (apenas um lugar)
    document.getElementById('logoutBtn').addEventListener('click', function(){
      localStorage.removeItem('loggedUser');
      window.location.href = 'login.html';
    });
  </script>

  <script src="SaoLuis.js" defer></script>
</body>
</html>
